!function(){var e;e=angular.module("adminApp",["ngCookies"]),e.controller("AdminIndexCtrl",["$scope","$location","$q","$cookieStore",function(e,t,n,r){return e.host=t.search().host||r.get("host")||t.host(),e.port=t.search().port||r.get("port"),e.database=t.search().database||r.get("database"),e.username=t.search().username||r.get("username"),e.password=t.search().password||r.get("password"),e.ssl=r.get("ssl")||!1,e.authenticated=!1,e.isClusterAdmin=!1,e.databases=[],e.admins=[],e.data=[],e.readQuery=null,e.writeSeriesName=null,e.writeValues=null,e.successMessage="OK",e.alertMessage="Error",e.authMessage="",e.queryMessage="",e.selectedPane="databases",e.selectedSubPane="users",e.newDbUser={},e.interfaces=[],e.databaseUsers=[],e.retentionPolicies=[],e.databaseUser=null,e.successMessage="",e.failureMessage="",e.newAdminUsername=null,e.newAdminPassword=null,e.newUserPassword=null,e.newUserPasswordConfirmation=null,window.influxdb=null,e.alertSuccess=function(t){return e.successMessage=t,$("#alert-success").show().delay(2500).fadeOut(500)},e.alertFailure=function(t){return e.failureMessage=t,$("#alert-failure").show().delay(2500).fadeOut(500)},e.humanize=function(e){return e.replace(/_/g," ").replace(/(\w+)/g,function(e){return e.charAt(0).toUpperCase()+e.slice(1)})},e.setCurrentInterface=function(t){return $("iframe").prop("src","/interfaces/"+t),e.selectedPane="data"},e.showDefaultInterface=function(t){return window.influxdb.database=t,$("iframe").prop("src","/interfaces/default"),e.selectedPane="data"},e.authenticateUser=function(){return e.database?e.authenticateAsDatabaseAdmin():e.authenticateAsClusterAdmin()},e.authenticateAsClusterAdmin=function(){return window.influxdb=new InfluxDB({hosts:[e.host],port:e.port,username:e.username,password:e.password,ssl:e.ssl}),e.authenticated=!0,e.isClusterAdmin=!0,e.isDatabaseAdmin=!1,e.selectedPane="databases",e.selectedSubPane="users",e.storeAuthenticatedCredentials(),e.getDatabases(),e.database?(e.selectedDatabase=e.database,e.showUsers()):void 0},e.authenticateAsDatabaseAdmin=function(){return window.influxdb=new InfluxDB({host:e.host,port:e.port,username:e.username,password:e.password,database:e.database,ssl:e.ssl}),e.authenticated=!0,e.isDatabaseAdmin=!0,e.isClusterAdmin=!1,e.selectedPane="databases",e.selectedSubPane="users",e.selectedDatabase=e.database,e.storeAuthenticatedCredentials(),e.showUsers()},e.storeAuthenticatedCredentials=function(){return r.put("username",e.username),r.put("password",e.password),r.put("database",e.database),r.put("host",e.host),r.put("port",e.port),r.put("ssl",e.ssl)},e.getDatabases=function(){return n.when(window.influxdb.showDatabases()).then(function(t){var n,r;return n=t.results[0],r=n.series[0],e.databases=r.values.map(function(e){return{name:e[0]}})})},e.createDatabaseUser=function(){return n.when(window.influxdb.createUser(e.selectedDatabase,e.newDbUser.username,e.newDbUser.password)).then(function(){return e.alertSuccess("Successfully created user: "+e.newDbUser.username),e.getDatabaseUsers()})},e.getUsers=function(){return n.when(window.influxdb.getUsers()).then(function(t){return e.users=t})},e.createDatabase=function(){return n.when(window.influxdb.createDatabase(e.newDatabaseName)).then(function(){return e.alertSuccess("Successfully created database: "+e.newDatabaseName),e.newDatabaseName=null,e.getDatabases()},function(t){return e.alertFailure("Failed to create database: "+t.responseText)})},e.deleteDatabase=function(t){return n.when(window.influxdb.dropDatabase(t)).then(function(){return e.alertSuccess("Successfully removed database: "+t),e.getDatabases()},function(t){return e.alertFailure("Failed to remove database: "+t.responseText)})},e.authError=function(t){return e.authMessage=t,$("span#authFailure").show().delay(1500).fadeOut(500)},e.error=function(t){return e.alertMessage=t,$("span#writeFailure").show().delay(1500).fadeOut(500)},e.success=function(t){return e.successMessage=t,$("span#writeSuccess").show().delay(1500).fadeOut(500)},e.filteredColumns=function(e){return e.columns.filter(function(e){return"time"!==e&&"sequence_number"!==e})},e.columnPoints=function(e,t){var n;return n=e.columns.indexOf(t),e.points.map(function(e){return{time:new Date(e[0]),value:e[n]}})},e.getDatabaseUsers=function(){return n.when(window.influxdb.showUsers()).then(function(t){var n,r;return n=t.results[0],r=n.series[0],e.databaseUsers=r.values?r.values.map(function(e){return{name:e[0],isAdmin:e[1]}}):[]})},e.getRetentionPolicies=function(){return n.when(window.influxdb.showRetentionPolicies(e.selectedDatabase)).then(function(t){var n,r;return n=t.results[0],r=n.series[0],e.retentionPolicies=r.values?r.values.map(function(e){return{name:e[0],duration:e[1],replicaN:e[2]}}):[]})},e.createRetentionPolicy=function(){return n.when(window.influxdb.createRetentionPolicy(e.selectedDatabase,e.newRetentionPolicyName,e.newRetentionPolicyDuration,e.newRetentionPolicyReplication,e.newRetentionPolicyIsDefault)).then(function(){return e.alertSuccess("Successfully created retention policy: "+e.newRetentionPolicyName),e.newRetentionPolicyName=null,e.newRetentionPolicyDuration=null,e.newRetentionPolicyReplication=null,e.newRetentionPolicyIsDefault=!1,e.getRetentionPolicies()},function(t){return e.alertFailure("Failed to create retention policy: "+t.responseText)})},e.getDatabaseUser=function(){return n.when(window.influxdb.getDatabaseUser(e.selectedDatabase,e.selectedDatabaseUser)).then(function(t){return e.databaseUser=t})},e.showSelectedDatabase=function(){return e.selectedPane="databases",e.selectedSubPane="users",e.selectedDatabaseUser=null,e.getDatabaseUsers(),e.getRetentionPolicies()},e.showDatabases=function(){return e.getDatabases(),e.selectedPane="databases",e.selectedSubPane="users",e.selectedDatabase=null,e.selectedDatabaseUser=null},e.showDatabase=function(t){return e.selectedDatabase=t.name,e.selectedDatabaseUser=null,e.getDatabaseUsers()},e.showDatabaseUsers=function(){return e.selectedDatabaseUser=null,e.selectedSubPane="users",e.getDatabaseUsers()},e.getContinuousQueries=function(){return n.when(window.influxdb.showContinuousQueries()).then(function(t){var n,r,i;return n=t.results[0],i=n.series.filter(function(t){return t.name===e.selectedDatabase}),r=i[0],e.continuousQueries=r.values?r.values.map(function(e){return{id:e[0],query:e[1]}}):[]})},e.showContinuousQueries=function(){return e.selectedDatabaseUser=null,e.selectedSubPane="continuousQueries",e.getContinuousQueries()},e.showRetentionPolicies=function(){return e.selectedDatabaseUser=null,e.selectedSubPane="retentionPolicies",e.getRetentionPolicies()},e.showDatabaseUser=function(t){return e.selectedDatabaseUser=t.name,e.getDatabaseUser()},e.changeDbUserPassword=function(){var t;return e.dbUserPassword!==e.dbUserPasswordConfirmation?e.alertFailure("Sorry, the passwords don't match."):null===e.dbUserPassword||""===e.dbUserPassword?e.alertFailure("Sorry, passwords cannot be blank."):(t={password:e.dbUserPassword},n.when(window.influxdb.updateDatabaseUser(e.selectedDatabase,e.selectedDatabaseUser,t)).then(function(){return e.alertSuccess("Successfully changed password for '"+e.selectedDatabaseUser+"'"),e.dbUserPassword=null,e.dbUserPasswordConfirmation=null},function(t){return e.alertFailure("Failed to change password for user: "+t.responseText)}))},e.changeClusterAdminPassword=function(){var t;return e.clusterAdminPassword!==e.clusterAdminPasswordConfirmation?e.alertFailure("Sorry, the passwords don't match."):null===e.clusterAdminPassword||""===e.clusterAdminPassword?e.alertFailure("Sorry, passwords cannot be blank."):(t={password:e.clusterAdminPassword},n.when(window.influxdb.updateClusterAdmin(e.selectedClusterAdmin,t)).then(function(){return e.alertSuccess("Successfully changed password for '"+e.selectedClusterAdmin+"'"),e.clusterAdminPassword=null,e.clusterAdminPasswordConfirmation=null},function(t){return e.alertFailure("Failed to change password for cluster admin: "+t.responseText)}))},e.updateDatabaseUser=function(){var t;return t={admin:e.databaseUser.isAdmin},n.when(window.influxdb.updateDatabaseUser(e.selectedDatabase,e.selectedDatabaseUser,t)).then(function(){return e.alertSuccess("Successfully updated database user '"+e.selectedDatabaseUser+"'"),e.getDatabaseUsers()},function(t){return e.alertFailure("Failed to update database user: "+t.responseText)})},e.deleteDatabaseUser=function(t){return n.when(window.influxdb.deleteDatabaseUser(e.selectedDatabase,t)).then(function(){return e.alertSuccess("Successfully delete user: "+t),e.getDatabaseUsers()},function(t){return e.alertFailure("Failed to delete user: "+t.responseText)})}}]),e.directive("ngConfirmClick",[function(){return{priority:-1,restrict:"A",link:function(e,t,n){return t.bind("click",function(e){var t;return t=n.ngConfirmClick,t&&!confirm(t)?(e.stopImmediatePropagation(),e.preventDefault()):void 0})}}}])}.call(this);